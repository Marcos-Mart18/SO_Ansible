- hosts: win11esxi
  gather_facts: no
  collections:
    - ansible.windows

  vars:
    domain_name: "gamecenter.lan"
    domain_admin_user: "GAMECENTER\\Administrador"   # tambi√©n vale Administrador@gamecenter.lan
    domain_admin_pass: "mrk87dwp_"
    dc_dns_v6: "2025:db8:1::2"
    dc_dns_v4: "10.10.10.2"
    nic_alias: "Ethernet0"   # cambia si tu interfaz se llama distinto

  tasks:
    - name: Apuntar DNS del cliente al DC (v6 y v4)
      ansible.windows.win_dns_client:
        adapter_names: "{{ nic_alias }}"
        ipv6_addresses: ["{{ dc_dns_v6 }}"]
        ipv4_addresses: ["{{ dc_dns_v4 }}"]

    - name: Unir al dominio
      ansible.windows.win_domain_membership:
        dns_domain_name: "{{ domain_name }}"
        domain_admin_user: "{{ domain_admin_user }}"
        domain_admin_password: "{{ domain_admin_pass }}"
        state: domain
      register: join_out

    - name: Reiniciar si es necesario
      ansible.windows.win_reboot:
      when: join_out.reboot_required | default(false)
